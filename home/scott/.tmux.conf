##### Prefix like GNU Screen
unbind C-b
set -g prefix C-a
bind C-a send-prefix

##### Splits like Screen
bind | split-window -h
bind - split-window -v

##### Windows
bind c new-window
bind n next-window
bind p previous-window
bind k kill-window
bind d detach
bind A command-prompt "rename-window %%"

# Screen-style window list
bind '"' choose-tree -Zw

##### Mouse + copy mode
set -g mouse on
setw -g mode-keys vi

# When ctrl+g is hit, clear the selection but stay in copy mode.
bind -T copy-mode-vi C-g send -X clear-selection
bind -T copy-mode    C-g send -X clear-selection

# Exit copy mode when escape is pressed
# In copy mode, make Escape behave like q: always cancel/exit
unbind Escape
unbind -T copy-mode Escape
unbind -T copy-mode-vi Escape

bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode    Escape send -X cancel

# Native clipboard support if available
set -g set-clipboard on

# Screen-like copy mode: Enter starts or finishes selection, copies via xclip
# Modified: when selection is active/present, Enter copies to clipboard, clears selection,
# but STAYS in copy mode.
bind -T copy-mode-vi Enter if -F '#{||:#{selection_active},#{selection_present}}' \
  'send -X copy-pipe "xclip -in"' \
  'send -X begin-selection'
bind -T copy-mode Enter if -F '#{||:#{selection_active},#{selection_present}}' \
  'send -X copy-pipe "xclip -in"' \
  'send -X begin-selection'

# Explicit yank key
bind -T copy-mode-vi y send -X copy-pipe-and-cancel "xclip -in"
bind -T copy-mode y send -X copy-pipe-and-cancel "xclip -in"

##### Status-left mode indicator (yellow)
set -g status-left-length 40
set -g status-left '#{?#{==:#{client_key_table},register-copy-save},#[bg=yellow]#[fg=black] COPY: REGISTER: CHOOSE KEY #[default] ,#{?#{==:#{client_key_table},register-copy},#[bg=yellow]#[fg=black] COPY: REGISTER #[default] ,#{?#{==:#{client_key_table},register-prefix-paste},#[bg=yellow]#[fg=black] PASTE: REGISTER: CHOOSE KEY #[default] ,#{?#{==:#{client_key_table},register-prefix},#[bg=yellow]#[fg=black] PASTE: REGISTER #[default] ,#{?pane_in_mode,#[bg=yellow]#[fg=black] COPY #[default] ,}}}}}'

##### Emacs-style registers (all requested keys)
# Copy mode: r s <reg-key> -> save selection into named buffer.
bind -T copy-mode-vi r switch-client -T register-copy
bind -T copy-mode    r switch-client -T register-copy

bind -T register-copy s switch-client -T register-copy-save
bind -T register-copy Escape switch-client -T copy-mode-vi
bind -T register-copy q switch-client -T copy-mode-vi

# Cancel out of "choose key" back to copy-mode
bind -T register-copy-save Escape switch-client -T copy-mode-vi
bind -T register-copy-save q switch-client -T copy-mode-vi

# Save selection into named buffers (pipe -> tmux load-buffer -b NAME -)
# digits
bind -T register-copy-save 0 send -X pipe "tmux load-buffer -b reg-0 -" \; display-message "saved reg-0" \; switch-client -T copy-mode-vi
bind -T register-copy-save 1 send -X pipe "tmux load-buffer -b reg-1 -" \; display-message "saved reg-1" \; switch-client -T copy-mode-vi
bind -T register-copy-save 2 send -X pipe "tmux load-buffer -b reg-2 -" \; display-message "saved reg-2" \; switch-client -T copy-mode-vi
bind -T register-copy-save 3 send -X pipe "tmux load-buffer -b reg-3 -" \; display-message "saved reg-3" \; switch-client -T copy-mode-vi
bind -T register-copy-save 4 send -X pipe "tmux load-buffer -b reg-4 -" \; display-message "saved reg-4" \; switch-client -T copy-mode-vi
bind -T register-copy-save 5 send -X pipe "tmux load-buffer -b reg-5 -" \; display-message "saved reg-5" \; switch-client -T copy-mode-vi
bind -T register-copy-save 6 send -X pipe "tmux load-buffer -b reg-6 -" \; display-message "saved reg-6" \; switch-client -T copy-mode-vi
bind -T register-copy-save 7 send -X pipe "tmux load-buffer -b reg-7 -" \; display-message "saved reg-7" \; switch-client -T copy-mode-vi
bind -T register-copy-save 8 send -X pipe "tmux load-buffer -b reg-8 -" \; display-message "saved reg-8" \; switch-client -T copy-mode-vi
bind -T register-copy-save 9 send -X pipe "tmux load-buffer -b reg-9 -" \; display-message "saved reg-9" \; switch-client -T copy-mode-vi

# letters
bind -T register-copy-save a send -X pipe "tmux load-buffer -b reg-a -" \; display-message "saved reg-a" \; switch-client -T copy-mode-vi
bind -T register-copy-save b send -X pipe "tmux load-buffer -b reg-b -" \; display-message "saved reg-b" \; switch-client -T copy-mode-vi
bind -T register-copy-save c send -X pipe "tmux load-buffer -b reg-c -" \; display-message "saved reg-c" \; switch-client -T copy-mode-vi
bind -T register-copy-save d send -X pipe "tmux load-buffer -b reg-d -" \; display-message "saved reg-d" \; switch-client -T copy-mode-vi
bind -T register-copy-save e send -X pipe "tmux load-buffer -b reg-e -" \; display-message "saved reg-e" \; switch-client -T copy-mode-vi
bind -T register-copy-save f send -X pipe "tmux load-buffer -b reg-f -" \; display-message "saved reg-f" \; switch-client -T copy-mode-vi
bind -T register-copy-save g send -X pipe "tmux load-buffer -b reg-g -" \; display-message "saved reg-g" \; switch-client -T copy-mode-vi
bind -T register-copy-save h send -X pipe "tmux load-buffer -b reg-h -" \; display-message "saved reg-h" \; switch-client -T copy-mode-vi
bind -T register-copy-save i send -X pipe "tmux load-buffer -b reg-i -" \; display-message "saved reg-i" \; switch-client -T copy-mode-vi
bind -T register-copy-save j send -X pipe "tmux load-buffer -b reg-j -" \; display-message "saved reg-j" \; switch-client -T copy-mode-vi
bind -T register-copy-save k send -X pipe "tmux load-buffer -b reg-k -" \; display-message "saved reg-k" \; switch-client -T copy-mode-vi
bind -T register-copy-save l send -X pipe "tmux load-buffer -b reg-l -" \; display-message "saved reg-l" \; switch-client -T copy-mode-vi
bind -T register-copy-save m send -X pipe "tmux load-buffer -b reg-m -" \; display-message "saved reg-m" \; switch-client -T copy-mode-vi
bind -T register-copy-save n send -X pipe "tmux load-buffer -b reg-n -" \; display-message "saved reg-n" \; switch-client -T copy-mode-vi
bind -T register-copy-save o send -X pipe "tmux load-buffer -b reg-o -" \; display-message "saved reg-o" \; switch-client -T copy-mode-vi
bind -T register-copy-save p send -X pipe "tmux load-buffer -b reg-p -" \; display-message "saved reg-p" \; switch-client -T copy-mode-vi
bind -T register-copy-save q send -X pipe "tmux load-buffer -b reg-q -" \; display-message "saved reg-q" \; switch-client -T copy-mode-vi
bind -T register-copy-save r send -X pipe "tmux load-buffer -b reg-r -" \; display-message "saved reg-r" \; switch-client -T copy-mode-vi
bind -T register-copy-save s send -X pipe "tmux load-buffer -b reg-s -" \; display-message "saved reg-s" \; switch-client -T copy-mode-vi
bind -T register-copy-save t send -X pipe "tmux load-buffer -b reg-t -" \; display-message "saved reg-t" \; switch-client -T copy-mode-vi
bind -T register-copy-save u send -X pipe "tmux load-buffer -b reg-u -" \; display-message "saved reg-u" \; switch-client -T copy-mode-vi
bind -T register-copy-save v send -X pipe "tmux load-buffer -b reg-v -" \; display-message "saved reg-v" \; switch-client -T copy-mode-vi
bind -T register-copy-save w send -X pipe "tmux load-buffer -b reg-w -" \; display-message "saved reg-w" \; switch-client -T copy-mode-vi
bind -T register-copy-save x send -X pipe "tmux load-buffer -b reg-x -" \; display-message "saved reg-x" \; switch-client -T copy-mode-vi
bind -T register-copy-save y send -X pipe "tmux load-buffer -b reg-y -" \; display-message "saved reg-y" \; switch-client -T copy-mode-vi
bind -T register-copy-save z send -X pipe "tmux load-buffer -b reg-z -" \; display-message "saved reg-z" \; switch-client -T copy-mode-vi

# punctuation: , . / - + [ ] =
bind -T register-copy-save , send -X pipe "tmux load-buffer -b reg-comma -" \; display-message "saved reg-comma" \; switch-client -T copy-mode-vi
bind -T register-copy-save . send -X pipe "tmux load-buffer -b reg-dot -" \; display-message "saved reg-dot" \; switch-client -T copy-mode-vi
bind -T register-copy-save / send -X pipe "tmux load-buffer -b reg-slash -" \; display-message "saved reg-slash" \; switch-client -T copy-mode-vi
bind -T register-copy-save -- - send -X pipe "tmux load-buffer -b reg-minus -" \; display-message "saved reg-minus" \; switch-client -T copy-mode-vi
bind -T register-copy-save + send -X pipe "tmux load-buffer -b reg-plus -" \; display-message "saved reg-plus" \; switch-client -T copy-mode-vi
bind -T register-copy-save [ send -X pipe "tmux load-buffer -b reg-lsq -" \; display-message "saved reg-lsq" \; switch-client -T copy-mode-vi
bind -T register-copy-save ] send -X pipe "tmux load-buffer -b reg-rsq -" \; display-message "saved reg-rsq" \; switch-client -T copy-mode-vi
bind -T register-copy-save = send -X pipe "tmux load-buffer -b reg-eq -" \; display-message "saved reg-eq" \; switch-client -T copy-mode-vi

# Normal mode: <prefix> r g <reg-key> -> paste from named buffer.
bind -T prefix r switch-client -T register-prefix

bind -T register-prefix g switch-client -T register-prefix-paste
bind -T register-prefix l choose-buffer \; switch-client -T root
bind -T register-prefix Escape switch-client -T root
bind -T register-prefix q switch-client -T root

bind -T register-prefix-paste Escape switch-client -T root
bind -T register-prefix-paste q switch-client -T root

# paste digits
bind -T register-prefix-paste 0 paste-buffer -b reg-0 \; switch-client -T root \; display-message "pasted reg-0"
bind -T register-prefix-paste 1 paste-buffer -b reg-1 \; switch-client -T root \; display-message "pasted reg-1"
bind -T register-prefix-paste 2 paste-buffer -b reg-2 \; switch-client -T root \; display-message "pasted reg-2"
bind -T register-prefix-paste 3 paste-buffer -b reg-3 \; switch-client -T root \; display-message "pasted reg-3"
bind -T register-prefix-paste 4 paste-buffer -b reg-4 \; switch-client -T root \; display-message "pasted reg-4"
bind -T register-prefix-paste 5 paste-buffer -b reg-5 \; switch-client -T root \; display-message "pasted reg-5"
bind -T register-prefix-paste 6 paste-buffer -b reg-6 \; switch-client -T root \; display-message "pasted reg-6"
bind -T register-prefix-paste 7 paste-buffer -b reg-7 \; switch-client -T root \; display-message "pasted reg-7"
bind -T register-prefix-paste 8 paste-buffer -b reg-8 \; switch-client -T root \; display-message "pasted reg-8"
bind -T register-prefix-paste 9 paste-buffer -b reg-9 \; switch-client -T root \; display-message "pasted reg-9"

# paste letters
bind -T register-prefix-paste a paste-buffer -b reg-a \; switch-client -T root \; display-message "pasted reg-a"
bind -T register-prefix-paste b paste-buffer -b reg-b \; switch-client -T root \; display-message "pasted reg-b"
bind -T register-prefix-paste c paste-buffer -b reg-c \; switch-client -T root \; display-message "pasted reg-c"
bind -T register-prefix-paste d paste-buffer -b reg-d \; switch-client -T root \; display-message "pasted reg-d"
bind -T register-prefix-paste e paste-buffer -b reg-e \; switch-client -T root \; display-message "pasted reg-e"
bind -T register-prefix-paste f paste-buffer -b reg-f \; switch-client -T root \; display-message "pasted reg-f"
bind -T register-prefix-paste g paste-buffer -b reg-g \; switch-client -T root \; display-message "pasted reg-g"
bind -T register-prefix-paste h paste-buffer -b reg-h \; switch-client -T root \; display-message "pasted reg-h"
bind -T register-prefix-paste i paste-buffer -b reg-i \; switch-client -T root \; display-message "pasted reg-i"
bind -T register-prefix-paste j paste-buffer -b reg-j \; switch-client -T root \; display-message "pasted reg-j"
bind -T register-prefix-paste k paste-buffer -b reg-k \; switch-client -T root \; display-message "pasted reg-k"
bind -T register-prefix-paste l paste-buffer -b reg-l \; switch-client -T root \; display-message "pasted reg-l"
bind -T register-prefix-paste m paste-buffer -b reg-m \; switch-client -T root \; display-message "pasted reg-m"
bind -T register-prefix-paste n paste-buffer -b reg-n \; switch-client -T root \; display-message "pasted reg-n"
bind -T register-prefix-paste o paste-buffer -b reg-o \; switch-client -T root \; display-message "pasted reg-o"
bind -T register-prefix-paste p paste-buffer -b reg-p \; switch-client -T root \; display-message "pasted reg-p"
bind -T register-prefix-paste q paste-buffer -b reg-q \; switch-client -T root \; display-message "pasted reg-q"
bind -T register-prefix-paste r paste-buffer -b reg-r \; switch-client -T root \; display-message "pasted reg-r"
bind -T register-prefix-paste s paste-buffer -b reg-s \; switch-client -T root \; display-message "pasted reg-s"
bind -T register-prefix-paste t paste-buffer -b reg-t \; switch-client -T root \; display-message "pasted reg-t"
bind -T register-prefix-paste u paste-buffer -b reg-u \; switch-client -T root \; display-message "pasted reg-u"
bind -T register-prefix-paste v paste-buffer -b reg-v \; switch-client -T root \; display-message "pasted reg-v"
bind -T register-prefix-paste w paste-buffer -b reg-w \; switch-client -T root \; display-message "pasted reg-w"
bind -T register-prefix-paste x paste-buffer -b reg-x \; switch-client -T root \; display-message "pasted reg-x"
bind -T register-prefix-paste y paste-buffer -b reg-y \; switch-client -T root \; display-message "pasted reg-y"
bind -T register-prefix-paste z paste-buffer -b reg-z \; switch-client -T root \; display-message "pasted reg-z"

# paste punctuation
bind -T register-prefix-paste , paste-buffer -b reg-comma \; switch-client -T root \; display-message "pasted reg-comma"
bind -T register-prefix-paste . paste-buffer -b reg-dot \; switch-client -T root \; display-message "pasted reg-dot"
bind -T register-prefix-paste / paste-buffer -b reg-slash \; switch-client -T root \; display-message "pasted reg-slash"
bind -T register-prefix-paste -- - paste-buffer -b reg-minus \; switch-client -T root \; display-message "pasted reg-minus"
bind -T register-prefix-paste + paste-buffer -b reg-plus \; switch-client -T root \; display-message "pasted reg-plus"
bind -T register-prefix-paste [ paste-buffer -b reg-lsq \; switch-client -T root \; display-message "pasted reg-lsq"
bind -T register-prefix-paste ] paste-buffer -b reg-rsq \; switch-client -T root \; display-message "pasted reg-rsq"
bind -T register-prefix-paste = paste-buffer -b reg-eq \; switch-client -T root \; display-message "pasted reg-eq"

# Screen-ish entry to copy/scrollback
bind [ copy-mode

##### “Only” current pane like Screen’s prefix q / Q
bind Q kill-pane -a
bind q kill-pane -a

##### Terminal / colors
set -g default-terminal "screen-256color"

# Mouse: don't auto-copy/exit on release; keep highlight and stay in copy-mode
unbind -T copy-mode-vi MouseDragEnd1Pane
unbind -T copy-mode    MouseDragEnd1Pane
bind   -T copy-mode-vi MouseDragEnd1Pane send -X stop-selection
bind   -T copy-mode    MouseDragEnd1Pane send -X stop-selection